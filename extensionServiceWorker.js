(()=>{var t,e={38531:(t,e,n)=>{"use strict";var a,o;n.d(e,{FH:()=>r,qV:()=>c,w5:()=>s});const r=Boolean(null===(a=self)||void 0===a||null===(a=a.chrome)||void 0===a||null===(a=a.runtime)||void 0===a?void 0:a.id),i=Boolean(null===(o=self)||void 0===o||null===(o=o.chrome)||void 0===o?void 0:o.system),s=r&&!i,c=r||!1},83716:(t,e,n)=>{"use strict";n.d(e,{Je:()=>d,Ji:()=>a,eM:()=>o,fi:()=>i,lr:()=>s,rH:()=>f,s1:()=>w,s4:()=>r,u4:()=>l,vc:()=>m,wS:()=>u,wU:()=>c});const a="1.15.0",o=!1,r=!1,i="0-ton-mainnet",s="https://toncenter.com/api/v2/jsonRPC",c=null,u="https://testnet.toncenter.com/api/v2/jsonRPC",d=null,l="https://mytonwallet-api.herokuapp.com",f="toncoin",w=null,m=[]},30514:(t,e,n)=>{"use strict";var a={};n.r(a),n.d(a,{checkMultiTransactionDraft:()=>Jn,checkStakeDraft:()=>ra,checkTransactionDraft:()=>_n,checkUnstakeDraft:()=>ia,decryptComment:()=>Qn,encryptMnemonic:()=>yt,fetchMnemonic:()=>gt,generateMnemonic:()=>ft,getAccountBalance:()=>ge,getAccountNewestTxId:()=>Un,getAccountNfts:()=>Te,getAccountTokenBalances:()=>mn,getAccountTransactionSlice:()=>Mn,getBackendStakingState:()=>la,getMergedTransactionSlice:()=>Wn,getNftUpdates:()=>Ee,getStakingState:()=>da,getTokenTransactionSlice:()=>jn,getWalletBalance:()=>he,getWalletSeqno:()=>ve,getWalletStateInit:()=>Ie,importToken:()=>bn,isWalletInitialized:()=>fe,mnemonicToSeed:()=>mt,oneCellFromBoc:()=>se,packPayloadToBoc:()=>wa,parsePayloadBase64:()=>Ve,pickAccountWallet:()=>Ae,pickBestWallet:()=>be,publicKeyToAddress:()=>me,rawSign:()=>bt,resolveTokenBySlug:()=>gn,resolveTokenMinterAddress:()=>Yt,resolveTokenWalletAddress:()=>Xt,resolveWalletVersion:()=>Se,seedToKeyPair:()=>pt,sendSignedMessage:()=>$n,sendSignedMessages:()=>Vn,submitMultiTransfer:()=>Hn,submitStake:()=>sa,submitTransfer:()=>Dn,submitUnstake:()=>ca,validateMnemonic:()=>wt,verifyPassword:()=>It,waitLastTransfer:()=>Zn});var o={};n.r(o),n.d(o,{connectDapp:()=>Na,deactivateDapp:()=>xa,flushMemoryCache:()=>Wa,getCurrentAccountIdOrFail:()=>ja,initDappMethods:()=>Da,prepareTransaction:()=>Ma,updateDapps:()=>Ua});var r={};n.r(r),n.d(r,{connect:()=>oi,deactivate:()=>ui,disconnect:()=>ii,initTonConnect:()=>ai,reconnect:()=>ri,sendTransaction:()=>si,signData:()=>ci});var i={};n.r(i),n.d(i,{activateAccount:()=>tr,cancelDappRequest:()=>br,checkStakeDraft:()=>So,checkTransactionDraft:()=>Pr,checkUnstakeDraft:()=>To,clearExtensionFeatures:()=>go,confirmDappRequest:()=>hr,confirmDappRequestConnect:()=>vr,createWallet:()=>sr,deactivateAllAccounts:()=>er,deactivateCurrentAccount:()=>nr,deactivateDapp:()=>Za,decryptComment:()=>xr,deleteAllDapps:()=>Ya,deleteDapp:()=>Xa,doDeeplinkHook:()=>Io,doMagic:()=>bo,doProxy:()=>ho,fetchAccount:()=>or,fetchAddress:()=>Ar,fetchAllTransactionSlice:()=>Or,fetchNfts:()=>Ur,fetchPublicKey:()=>Sr,fetchTokenTransactionSlice:()=>Br,fetchTransactions:()=>Rr,generateMnemonic:()=>ir,getActiveAccountId:()=>rr,getActiveDapp:()=>La,getBackendStakingState:()=>Bo,getDapps:()=>to,getDappsByOrigin:()=>eo,getMnemonic:()=>yr,getStakingState:()=>Ro,getWalletSeqno:()=>Ir,importLedgerWallet:()=>dr,importMnemonic:()=>ur,importToken:()=>Mr,initDapps:()=>Fa,initExtension:()=>po,initPolling:()=>Ko,initStaking:()=>Ao,initTransactions:()=>Er,initWallet:()=>pr,isAccountActive:()=>ar,isDappConnected:()=>no,isWalletInitialized:()=>Tr,removeAccount:()=>wr,resetAccounts:()=>fr,resolveTokenBySlug:()=>Wr,resolveTokenMinterAddress:()=>qr,resolveTokenWalletAddress:()=>jr,sendSignedTransferMessage:()=>Dr,sendSignedTransferMessages:()=>Nr,sendUpdateTokens:()=>$o,setupBackendPolling:()=>Lo,setupBackendStakingStatePolling:()=>Vo,setupBalanceBasedPolling:()=>Ho,setupDefaultExtensionFeatures:()=>yo,setupLongBackendPolling:()=>Zo,startSseConnection:()=>Ai,submitStake:()=>ko,submitTransfer:()=>Cr,submitUnstake:()=>Eo,swapBuild:()=>Ri,swapEstimate:()=>Ei,swapGetCurrencies:()=>Bi,swapGetTonCurrencies:()=>Oi,swapGetTonPairs:()=>Pi,tryUpdateTokens:()=>zo,validateMnemonic:()=>cr,verifyPassword:()=>gr,waitDataPreload:()=>Go,waitLastTransfer:()=>_r});var s={};n.r(s),n.d(s,{getBalance:()=>xi,initLegacyDappMethods:()=>Di,onDappSendUpdates:()=>Ni,rawSign:()=>ji,requestAccounts:()=>Ui,requestWallets:()=>Mi,sendTransaction:()=>Wi});var c=n(51086);var u=n(41535);const d=new Map;function l(t,e,n,a){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];c.Z.runtime.onConnect.addListener((r=>{var i;if(r.name!==t)return;const s=null===(i=r.sender)||void 0===i?void 0:i.url;if(null!=s&&s.includes("#detached"))return;const c=s?new URL(s).origin:void 0,u=t=>{d({type:"update",update:t})};function d(t){t.channel=n,r.postMessage(t)}(function(t){self.onerror=e=>{var n;console.error(e),t({type:"unhandledError",error:{message:(null===(n=e.error)||void 0===n?void 0:n.message)||"Uncaught exception in worker"}})},self.addEventListener("unhandledrejection",(e=>{var n;console.error(e),t({type:"unhandledError",error:{message:(null===(n=e.reason)||void 0===n?void 0:n.message)||"Uncaught rejection in worker"}})}))})(d),r.onMessage.addListener((t=>{t.channel===n&&f(e,t,d,u,c)})),r.onDisconnect.addListener((()=>{null==a||a(u)})),o&&f(e,{type:"init",name:"init",args:[]},d,u)}))}async function f(t,e,n,a,o){switch(a||(a=t=>{n({type:"update",update:t})}),e.type){case"init":{var r;const{args:n}=e,i="function"==typeof t?t("init",o,a,...n):null===(r=t.init)||void 0===r?void 0:r.call(t,a,...n);await i;break}case"callMethod":{const{messageId:a,name:r,args:i,withCallback:s}=e;try{if(a&&s){const t=function(){for(var t=arguments.length,e=new Array(t),o=0;o<t;o++)e[o]=arguments[o];const r=e[e.length-1];var i;n({type:"methodCallback",messageId:a,callbackArgs:e},(i=r)instanceof ArrayBuffer||i instanceof ImageBitmap?[r]:void 0)};d.set(a,t),i.push(t)}const e="function"==typeof t?await t(r,o,...i):await t[r](...i),{arrayBuffer:c}="object"==typeof e&&"arrayBuffer"in e&&e||{};a&&n({type:"methodResponse",messageId:a,response:e},c?[c]:void 0)}catch(t){(0,u.J)("onMessage:callMethod",t),a&&n({type:"methodResponse",messageId:a,error:{message:t.message}})}a&&d.delete(a);break}case"cancelProgress":{const t=d.get(e.messageId);t&&(t.isCanceled=!0);break}}}var w=n(83716);function m(t){const[e,n="ton",a="mainnet"]=t.split("-");return{id:Number(e),blockchain:n,network:a}}function p(t){const{id:e,network:n,blockchain:a}=t;return`${e}-${a}-${n}`}var y=n(38531),g=n(41742),h=n(51684),v=n(85476),b=n(34195);const I=y.FH?h.Z:v.Z;g.Z.IndexedDb,v.Z,g.Z.LocalStorage,b.Z,g.Z.ExtensionLocal,h.Z;var A=n(60782),S=n(60779),T=n.n(S);function k(t){return T().utils.bytesToHex(t)}function E(t){return T().utils.hexToBytes(t)}function R(t){return T().utils.bytesToBase64(t)}function B(t){return T().utils.base64ToBytes(t)}function O(t){return T().utils.sha256(t)}function P(t){if(!t.ok)throw new Error(t.statusText);return t}function C(t){return w.vc.some((e=>t.endsWith(e)))}async function _(t,e){const n=await fetch(`${w.u4}${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return P(n),n.json()}async function D(t,e,n){const a=new URL(`${w.u4}${t}`);e&&Object.entries(e).forEach((t=>{let[e,n]=t;a.searchParams.set(e,n.toString())}));const o=await fetch(a,{headers:n});return P(o),o.json()}let N,x;async function U(){try{const t=await D("/known-addresses");N=(0,A.Q8)(t.knownAddresses,(t=>"string"==typeof t?{name:t}:t)),x=t.scamMarkers.map((t=>new RegExp(t,"i")))}catch(t){(0,u.J)("tryUpdateKnownAddresses",t)}}function M(){return N}function W(){return x}const j=(0,n(16063)._)();let q=0;const K=()=>`${Date.now()}|${q++}`,J=6;let H,F;function L(t){return m(t).blockchain}function Z(t){return function(t){const{id:e,blockchain:n}=t;return`${e}-${n}`}(m(t))}function z(t,e,n){const{amount:a,fromAddress:o,toAddress:r,comment:i,fee:s,slug:c,type:u,encryptedComment:d}=n,l=function(t){const{amount:e,...n}=t;return $({txId:K(),timestamp:Date.now(),isIncoming:!1,amount:`-${e}`,...n})}({amount:a,fromAddress:o,toAddress:r,comment:i,fee:s,slug:c,type:u,encryptedComment:d});return t({type:"newLocalTransaction",transaction:l,accountId:e}),function(t,e){return new Promise((n=>{j.addCallback((function a(o){o.toAddress===t&&o.amount===`-${e}`&&(j.removeCallback(a),n({result:!0,txId:o.txId}))}))}))}(r,a).then((n=>{let{txId:o}=n;t({type:"updateTxComplete",accountId:e,toAddress:r,amount:a,txId:o,localTxId:l.txId})})),l}function $(t){const{isIncoming:e,fromAddress:n,toAddress:a,comment:o}=t;let{metadata:r={}}=t;const i=M(),s=W(),c=e?n:a;return c in i&&(r={...r,...i[c]}),o&&s.map((t=>t.test(o))).find(Boolean)&&(r.isScam=!0),{...t,metadata:r}}function V(t){return F===t}var Q=n(56845),G=n(50780),X=n.n(G);const Y=0;let tt;const et=new Promise((t=>{tt=t}));async function nt(){return Object.keys(await I.getItem("addresses")||{})}async function at(t){const e=(await nt()).map((t=>m(t).id));return p({id:0===e.length?Y:Math.max(...e)+1,network:t,blockchain:"ton"})}function ot(t){return st(t,"accounts")}function rt(t){return st(t,"publicKeys")}function it(t){return st(t,"addresses")}async function st(t,e){var n;const a=Z(t);return null===(n=await I.getItem(e))||void 0===n?void 0:n[a]}async function ct(t,e){const n=Z(t),a=await I.getItem(e);if(!a)return;const{[n]:o,...r}=a;await I.setItem(e,r)}async function ut(t,e,n){const a=Z(t),o=await I.getItem(e);await I.setItem(e,{...o,[a]:n})}function dt(){return I.getItem("currentAccountId")}function lt(){return et}function ft(){return Q.generateMnemonic()}function wt(t){return Q.validateMnemonic(t)}async function mt(t){return R((await Q.mnemonicToKeyPair(t)).secretKey.slice(0,32))}function pt(t){return X().sign.keyPair.fromSeed(B(t))}async function yt(t,e){const n=t.join(","),a=(new TextEncoder).encode(e),o=await crypto.subtle.digest("SHA-256",a),r=crypto.getRandomValues(new Uint8Array(12)),i={name:"AES-GCM",iv:r},s=await crypto.subtle.importKey("raw",o,i,!1,["encrypt"]),c=(new TextEncoder).encode(n),u=await crypto.subtle.encrypt(i,s,c),d=Array.from(new Uint8Array(u)).map((t=>String.fromCharCode(t))).join(""),l=btoa(d);return Array.from(r).map((t=>`00${t.toString(16)}`.slice(-2))).join("")+l}async function gt(t,e){try{const n=await st(t,"mnemonicsEncrypted");return await async function(t,e){const n=(new TextEncoder).encode(e),a=await crypto.subtle.digest("SHA-256",n),o=t.slice(0,24).match(/.{2}/g).map((t=>parseInt(t,16))),r={name:"AES-GCM",iv:new Uint8Array(o)},i=await crypto.subtle.importKey("raw",a,r,!1,["decrypt"]),s=atob(t.slice(24)),c=new Uint8Array(s.match(/[\s\S]/g).map((t=>t.charCodeAt(0)))),u=await crypto.subtle.decrypt(r,i,c);return(new TextDecoder).decode(u).split(",")}(n,e)}catch(t){return void console.error(t)}}async function ht(t,e){try{const n=await gt(t,e);if(!n)return;const a=await mt(n),{secretKey:o}=pt(a);return o}catch(t){return void console.error(t)}}async function vt(t,e){try{const n=await gt(t,e);if(!n)return;return await Q.mnemonicToKeyPair(n)}catch(t){return void(0,u.J)("fetchKeyPair",t)}}async function bt(t,e,n){const a=await ht(t,e);if(a)return k(X().sign.detached(E(n),a))}async function It(t,e){const n=await gt(t,e);return Boolean(n)}var At=n(63824);const St=1e3,Tt=new At.Configuration({basePath:"https://tonapi.io"}),kt=new At.Configuration({basePath:"https://testnet.tonapi.io"}),Et={mainnet:{configuration:Tt,blockchainApi:new At.BlockchainApi(Tt),nftApi:new At.NFTApi(Tt),accountsApi:new At.AccountsApi(Tt)},testnet:{configuration:kt,blockchainApi:new At.BlockchainApi(kt),nftApi:new At.NFTApi(kt),accountsApi:new At.AccountsApi(kt)}};function Rt(t,e){const n=Et[t].nftApi;return Bt((async()=>(await n.getNftItemsByAddresses({getAccountsRequest:{accountIds:e}})).nftItems),[])}async function Bt(t,e){try{return await t()||e}catch(t){if(t instanceof At.ResponseError){const n=await t.response.json().catch();if("entity not found"===(null==n?void 0:n.error))return e}throw(0,u.J)("tonapiioErrorHandler",t),t}}var Ot=n(13550),Pt=n.n(Ot),Ct=n(53916);const _t=50000000n,Dt=1n,Nt="d",xt="w",Ut=5,Mt=9,Wt=["transfer-nft","transfer-tokens","comment"];let jt=function(t){return t[t.Comment=0]="Comment",t[t.Encrypted=560454219]="Encrypted",t}({}),qt=function(t){return t[t.Transfer=260734629]="Transfer",t[t.TransferNotification=1935855772]="TransferNotification",t[t.InternalTransfer=395134233]="InternalTransfer",t[t.Excesses=3576854235]="Excesses",t[t.Burn=1499400124]="Burn",t[t.BurnNotification=2078119902]="BurnNotification",t}({}),Kt=function(t){return t[t.TransferOwnership=1607220500]="TransferOwnership",t}({});function Jt(t){let{lt:e,hash:n}=t;return`${e}:${n}`}function Ht(t){const[e,n]=t.split(":");return{lt:Number(e),hash:n}}function Ft(t){return`ton-${t.replace(/[^a-z\d]/gi,"").slice(0,10)}`.toLowerCase()}var Lt=n(20701),Zt=n(48764).lW;const{Cell:zt}=T().boc,{Address:$t}=T().utils,{JettonMinter:Vt,JettonWallet:Qt}=T().token.jetton,Gt={mainnet:new(T())(new Lt.Z(w.lr,{apiKey:w.wU})),testnet:new(T())(new Lt.Z(w.wS,{apiKey:w.Je}))},Xt=(0,Ct.Z)((async(t,e,n)=>{const a=new Vt(ie(t).provider,{address:n});return ce(await a.getJettonWalletAddress(new $t(e)))})),Yt=(0,Ct.Z)((async(t,e)=>{const n=new Qt(ie(t).provider,{address:e});return ce((await n.getData()).jettonMinterAddress)})),te=(0,Ct.Z)((async(t,e)=>{try{let n=(await ie(t).provider.call2(e,"get_public_key")).toString(16);return n.length%2!=0&&(n=`0${n}`),E(n)}catch(t){return}}));async function ee(t,e,n,a,o){const r=ie(t),i=a?Ht(a).lt:void 0,s=a?Ht(a).hash:void 0,c=o?Ht(o).lt:void 0;return(await r.provider.getTransactions(e,n,i,s,c,!0)).map(ne).flat()}function ne(t){const{utime:e,transaction_id:{lt:n,hash:a},fee:o}=t,r=Jt({lt:n,hash:a}),i=1e3*e,s=!!t.in_msg.source,c=s?[t.in_msg]:t.out_msgs;return c.length?c.map(((t,e)=>{const{source:n,destination:a,value:u}=t;return{txId:c.length>1?`${r}:${e+1}`:r,timestamp:i,isIncoming:s,fromAddress:n,toAddress:a,amount:s?u:`-${u}`,comment:ae(t),encryptedComment:oe(t),slug:w.rH,fee:o,extraData:{body:re(t)}}})):[]}function ae(t){if(!t.msg_data)return;if("msg.dataText"!==t.msg_data["@type"])return;const e=t.msg_data.text;return(new TextDecoder).decode(T().utils.base64ToBytes(e))}function oe(t){if(t.msg_data&&"msg.dataEncryptedText"===t.msg_data["@type"])return t.msg_data.text}function re(t){if(t.msg_data&&"msg.dataRaw"===t.msg_data["@type"])return t.msg_data.body}function ie(){return Gt[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"mainnet"]}function se(t){return T().boc.Cell.oneFromBoc(t)}function ce(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new(T().utils.Address)(t).toString(!0,!0,e)}function ue(t){return new(T().utils.Address)(t).toString(!1)}function de(t){return new $t(`0:${t.toString("hex",64)}`).toString(!0,!0,!0)}const le="v4R2",fe=(0,Ct.Z)((async(t,e)=>(await ye(t,e)).isInitialized)),we=(0,Ct.Z)((async(t,e)=>{const{isInitialized:n,isWallet:a}=await ye(t,e);return n&&!a}));async function me(t,e){const n=pe(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:le);return(await n.getAddress()).toString(!0,!0,!0)}function pe(t,e,n){const a=ie(t);return new(0,a.wallet.all[n])(a.provider,{publicKey:e,wc:0})}async function ye(t,e){const n="string"==typeof e?e:(await e.getAddress()).toString(!0,!0,!0),{account_state:a,wallet:o,seqno:r,balance:i="0"}=await ie(t).provider.getWalletInfo(n);return{isInitialized:"active"===a,isWallet:o,seqno:r,balance:i}}async function ge(t){const{network:e}=m(t);return he(e,await it(t))}async function he(t,e){const{balance:n}=await ye(t,e);return n||"0"}async function ve(t,e){const{seqno:n}=await ye(t,e);return n||0}async function be(t,e){const n=ie(t),a=Object.values(n.wallet.all),o=await Promise.all(a.map((async a=>{const o=new a(n.provider,{publicKey:e,wc:0}),r=await he(t,o);if("0"!==r)return{wallet:o,balance:BigInt(r)}}))),r=(0,A.oA)(o).reduce(((t,e)=>t&&(null==t?void 0:t.balance)>e.balance?t:e),void 0);return(null==r?void 0:r.wallet)||pe(t,e,le)}async function Ie(t){const e=await Ae(t),{stateInit:n}=await e.createStateInit();return R(await n.toBoc())}async function Ae(t){const{network:e}=m(t),[n,a,o]=await Promise.all([rt(t),it(t),ot(t)]),r=E(n);return null!=o&&o.version?pe(e,r,o.version):async function(t,e,n){var a;n=ce(n);const o=ie(t),r=o.wallet.list;return null===(a=(await Promise.all(r.map((async t=>{const n=new t(o.provider,{publicKey:e,wc:0}),a=(await n.getAddress()).toString(!0,!0,!0);return{wallet:n,address:a}})))).find((t=>t.address===n)))||void 0===a?void 0:a.wallet}(e,r,a)}function Se(t){const e=ie();return Object.keys(e.wallet.all).find((n=>t instanceof e.wallet.all[n]))}async function Te(t,e,n){const{network:a}=m(t),o=await it(t),r=await function(t,e,n,a){const o=Et[t].accountsApi;return Bt((async()=>(await o.getNftItemsByOwner({accountId:e,offset:null!=n?n:0,limit:null!=a?a:St,indirectOwnership:!0})).nftItems),[])}(a,o,e,n);return(0,A.oA)(r.map(ke))}function ke(t){if(t.metadata)try{const{address:e,index:n,collection:a,metadata:{name:o,image:r},previews:i,sale:s}=t;return{index:n,name:o,address:ce(e),image:r,thumbnail:i.find((t=>"500x500"===t.resolution)).url,isOnSale:Boolean(s),...a&&{collectionAddress:ce(a.address),collectionName:a.name}}}catch(t){return}}async function Ee(t,e){var n,a;const{network:o}=m(t),r=await it(t),i=await function(t,e,n,a){const o=Et[t].accountsApi;return Bt((async()=>(await o.getEventsByAccount({accountId:e,limit:St,startDate:n})).events),[])}(o,r,e);e=null!==(n=null===(a=i[0])||void 0===a?void 0:a.timestamp)&&void 0!==n?n:e,i.reverse();const s=[];for(const e of i)for(const n of e.actions){let e,a,i;const c=!!n.nftPurchase;if(n.nftItemTransfer){const{sender:t,recipient:o,nft:r}=n.nftItemTransfer;if(!t||!o)continue;e=ce(o.address),a=ce(r)}else{if(!n.nftPurchase)continue;{const{buyer:t}=n.nftPurchase;e=ce(t.address),i=n.nftPurchase.nft,a=ce(i.address)}}e===r?(i||([i]=await Rt(o,[a])),s.push({type:"nftReceived",accountId:t,nftAddress:a,nft:ke(i)})):!c&&await we(o,e)?s.push({type:"nftPutUpForSale",accountId:t,nftAddress:a}):s.push({type:"nftSent",accountId:t,nftAddress:a})}return[e,s]}var Re=n(65201);const Be=function(t){return t[t.MasterChain=-1]="MasterChain",t[t.BaseChain=0]="BaseChain",t}({}).BaseChain;var Oe=n(48348),Pe=n(24889),Ce=n(36262),_e=n(69118),De=n(48764).lW;const Ne=n(84553),xe=n(52310),{Address:Ue}=T().utils;function Me(t){if(t.length<48)throw new Error;const e=t.slice(0,32),n=t.slice(32,48);return new xe.ModeOfOperation.cbc(e,n)}function We(t,e){return async function(t,e){const n={name:"HMAC",hash:"SHA-512"},a=await crypto.subtle.importKey("raw",t,n,!1,["sign"]),o=await crypto.subtle.sign(n,a,e),r=new Uint8Array(o);if(64!==r.length)throw new Error;return r}(t,e)}async function je(t,e,n,a,o){if(!t||!t.length)throw new Error("empty comment");64===a.length&&(a=a.slice(0,32));const r=(new TextEncoder).encode(t),i=(new TextEncoder).encode(new Ue(o).toString(!0,!0,!0,!1)),s=await async function(t,e,n,a,o){const r=await Ne.getSharedSecret(a,n),i=await async function(t,e,n){const a=await function(t,e){const n=(31+t&-16)-t,a=crypto.getRandomValues(new Uint8Array(n));if(a[0]=n,(n+t)%16!=0)throw new Error;return a}(t.length),o=new Uint8Array(a.length+t.length);return o.set(a,0),o.set(t,a.length),async function(t,e,n){if(t.length%16!=0)throw new Error;const a=(await We(n,t)).slice(0,16),o=new Uint8Array(t.length+16);o.set(a,0);const r=await We(e,a),i=(await Me(r)).encrypt(t);return o.set(i,16),o}(o,e,n)}(t,r,o),s=new Uint8Array(e.length+i.length);for(let t=0;t<e.length;t++)s[t]=n[t]^e[t];return s.set(i,e.length),s}(r,e,n,a,i),c=new Uint8Array(s.length+4),u=De.alloc(4);return u.writeUInt32BE(jt.Encrypted),c.set(u,0),c.set(s,4),c}async function qe(t,e,n,a){64===n.length&&(n=n.slice(0,32));const o=(new TextEncoder).encode(new Ue(a).toString(!0,!0,!0,!1)),r=await async function(t,e,n,a){if(t.length<e.length)throw new Error("Failed to decrypt: data is too small");const o=new Uint8Array(e.length);for(let n=0;n<e.length;n++)o[n]=t[n]^e[n];const r=await Ne.getSharedSecret(n,o);return await async function(t,e,n){if(t.length<16)throw new Error("Failed to decrypt: data is too small");if(t.length%16!=0)throw new Error("Failed to decrypt: data size is not divisible by 16");const a=t.slice(0,16),o=t.slice(16),r=await We(e,a),i=await async function(t,e,n,a){const o=(await Me(t)).decrypt(n),r=(await We(a,o)).slice(0,16);if(e.join(",")!==r.join(","))throw new Error("Failed to decrypt: hash mismatch");const i=o[0];if(i>o.length||i<16)throw new Error("Failed to decrypt: invalid prefix size");return o.slice(i)}(r,a,o,n);return i}(t.slice(e.length),r,a)}(t,e,n,o);return(new TextDecoder).decode(r)}var Ke=n(48764).lW;const Je="https://ipfs.io/ipfs/",He=0;function Fe(t){return t.toString({urlSafe:!0,bounceable:!0})}function Le(t){return t.replace("ipfs://",Je)}const Ze={parse:t=>{const e=Ke.from(""),n=(t,e,a)=>{if(a&&0!==t.loadUint(8))throw new Error("Only snake format is supported");return e=Ke.concat([e,t.loadBuffer(t.remainingBits/8)]),1===t.remainingRefs&&(e=n(t.loadRef().beginParse(),e,!1)),e};return n(t.loadRef().beginParse(),e,!0)},serialize:()=>{}},ze={uri:"ascii",name:"utf8",description:"utf8",image:"ascii",symbol:"utf8",decimals:"utf8"};async function $e(t){const e=await async function(t){t=Le(t);const e=await fetch(t);return P(e),e.json()}(t);return(0,A.ei)(e,["name","description","symbol","decimals","image","image_data"])}async function Ve(t,e,n){var a;const o=Ge(n),r={type:"unknown",base64:n};return o&&null!==(a=await Qe(t,e,o))&&void 0!==a?a:r}async function Qe(t,e,n){try{const i=n.loadUint(32);if(i===jt.Comment)return{type:"comment",comment:n.loadStringTail()};if(i===jt.Encrypted)return{type:"encrypted-comment",encryptedComment:n.loadBuffer(n.remainingBits/8).toString("base64")};const s=n.loadUint(64).toString();switch(i){case qt.Transfer:{var a;const o=Ft(await Yt(t,e)),r=n.loadCoins(),i=n.loadAddress(),c=n.loadMaybeAddress();if(!c)return{type:"transfer-tokens:non-standard",queryId:s,destination:Fe(i),amount:r.toString(),slug:o};const u=n.loadMaybeRef(),d=n.loadCoins();let l=n.loadMaybeRef();if(!l&&n.remainingBits){const t=(new Re.Builder).storeBits(n.loadBits(n.remainingBits));(0,A.w6)(0,n.remainingRefs).forEach((()=>{t.storeRef(n.loadRef())})),l=t.endCell()}return{type:"transfer-tokens",queryId:s,amount:r.toString(),destination:Fe(i),responseDestination:Fe(c),customPayload:null==u?void 0:u.toBoc().toString("base64"),forwardAmount:d.toString(),forwardPayload:null===(a=l)||void 0===a?void 0:a.toBoc().toString("base64"),slug:o}}case Kt.TransferOwnership:{var o,r;const a=n.loadAddress(),i=n.loadAddress(),c=n.loadMaybeRef(),u=n.loadCoins();let d=n.loadMaybeRef();if(!d&&n.remainingBits){const t=(new Re.Builder).storeBits(n.loadBits(n.remainingBits));(0,A.w6)(0,n.remainingRefs).forEach((()=>{t.storeRef(n.loadRef())})),d=t.endCell()}const l=e,[f]=await Rt(t,[l]);return{type:"transfer-nft",queryId:s,newOwner:Fe(a),responseDestination:Fe(i),customPayload:null==c?void 0:c.toBoc().toString("base64"),forwardAmount:u.toString(),forwardPayload:null===(o=d)||void 0===o?void 0:o.toBoc().toString("base64"),nftAddress:l,nftName:null==f||null===(r=f.metadata)||void 0===r?void 0:r.name}}}}catch(t){(0,u.J)("parsePayload",t)}}function Ge(t){let e;e="string"==typeof t?Ke.from(t,"base64"):t instanceof Ke?t:Ke.from(t);try{return Re.Cell.fromBoc(e)[0].beginParse()}catch(t){if("Invalid magic"!==(null==t?void 0:t.message))throw t}return new Re.Slice(new Re.BitReader(new Re.BitString(e,0,8*e.length)),[])}var Xe=n(98741),Ye=n(9669),tn=n.n(Ye),en=n(48764).lW;tn().defaults.adapter=n(77361).Z;const nn={mainnet:new Xe.TonClient({endpoint:w.lr}),testnet:new Xe.TonClient({endpoint:w.wS})},an={simpleR1:Xe.WalletContractV1R1,simpleR2:Xe.WalletContractV1R2,simpleR3:Xe.WalletContractV1R3,v2R1:Xe.WalletContractV2R1,v2R2:Xe.WalletContractV2R2,v3R1:Xe.WalletContractV3R1,v3R2:Xe.WalletContractV3R2,v4R1:void 0,v4R2:Xe.WalletContractV4};function on(t,e){const n=an[e];if(!n)throw new Error("Unsupported wallet contract version");const a=en.from(E(t));return n.create({workchain:Be,publicKey:a})}function rn(t){return nn[t]}const sn={ton:/^([-\da-z]{4,126})\.ton$/i,"t.me":/^([-_\da-z]{4,126})\.t\.me$/i,vip:/^([\da-z]{1,24})\.(vip|vip\.ton|ton\.vip)$/i},cn={zones:["ton","t.me","vip"],zonesRegex:sn,isDnsDomain:function(t){return Object.values(sn).some((e=>e.test(t)))},isVipDnsDomain:function(t){return sn.vip.test(t)},removeZone:function(t){return Object.values(sn).map((e=>e.test(t)&&t.match(e)[1])).find(Boolean)}},{DnsCollection:un}=n(67594),dn="EQBWG4EBbPDv4Xj7xlPwzxd7hSyHMzwwLB5O6rY-0BBeaixS";async function ln(t,e){if(!cn.isDnsDomain(e))return e;const n=e,a=await ie(t);try{var o;if(cn.isVipDnsDomain(n)){var r;const t=cn.removeZone(n);return null===(r=await new un(a.provider,{address:dn}).resolve(t,"wallet"))||void 0===r?void 0:r.toString(!0,!0,!0)}return null===(o=await a.dns.getWalletAddress(n))||void 0===o?void 0:o.toString(!0,!0,!0)}catch(t){if("http provider parse response error"!==t.message)throw t;return}}const{JettonWallet:fn}=T().token.jetton,wn={};async function mn(t){const{network:e}=m(t),n=await it(t),a=await function(t,e){const n=Et[t].accountsApi;return Bt((async()=>(await n.getJettonsBalances({accountId:e})).balances),[])}(e,n);return a.map(pn).filter(Boolean)}function pn(t){if(t.jetton)try{const{balance:e,jetton:n}=t,a=In(ce(n.address),n);return{slug:a.slug,balance:e,token:a}}catch(t){return void(0,u.J)("parseTokenBalance",t)}}async function yn(t,e,n,a,o,r){const i=gn(e).minterAddress,s=await Xt(t,n,i);if(i!==await Yt(t,s))throw new Error("Invalid contract");const c=function(t,e){return new fn(ie(t).provider,{address:e})}(t,s),u=function(t){const{queryId:e,tokenAmount:n,toAddress:a,responseAddress:o,forwardAmount:r}=t;let i=t.forwardPayload;const s=new zt;if(s.bits.writeUint(qt.Transfer,32),s.bits.writeUint(e||0,64),s.bits.writeCoins(new(Pt())(n)),s.bits.writeAddress(new $t(a)),s.bits.writeAddress(new $t(o)),s.bits.writeBit(!1),s.bits.writeCoins(new(Pt())(r||"0")),"string"==typeof i){const t=Zt.from(i);s.bits.getFreeBits()<8*t.length+32+1&&(i=new zt,i.bits.writeUint(0,32),i.bits.writeBytes(t))}return i?"string"==typeof i?(s.bits.writeBit(!1),s.bits.writeUint(0,32),s.bits.writeBytes(Zt.from(i))):(s.bits.writeBit(!0),s.refs.push(i)):s.bits.writeBit(!1),s}({tokenAmount:o,toAddress:a,forwardAmount:Dt.toString(),forwardPayload:r,responseAddress:n});return{tokenWallet:c,amount:_t.toString(),toAddress:s,payload:u}}function gn(t){return wn[t]}function hn(){return wn}function vn(t){for(const e of t)e.slug in wn||(wn[e.slug]={...e,quote:{price:0,percentChange1h:0,percentChange24h:0,percentChange7d:0,percentChange30d:0}})}async function bn(t,e){return In(e,await async function(t,e){const{jettonContentUri:n,jettonContentCell:a}=await async function(t,e){const n=new Vt(ie(t).provider,{address:e}),a=await n.getJettonData();return{...a,totalSupply:a.totalSupply.toString(),adminAddress:a.adminAddress?ce(a.adminAddress):void 0}}(t,e);let o;return n?o=await $e(n):(o=await async function(t){const e=Re.Cell.fromBoc(Ke.from(t))[0].beginParse();if(e.loadUint(8)!==He)throw new Error("Expected onchain content marker");const n=e.loadDict(Re.Dictionary.Keys.Buffer(32),Ze),a={};for(const[t,e]of Object.entries(ze)){var o;const r=Ke.from(await O(Ke.from(t,"ascii"))),i=null===(o=n.get(r))||void 0===o?void 0:o.toString(e);i&&(a[t]=i)}return a}(await a.toBoc()),o.uri&&(o={...await $e(o.uri),...o})),o}(t,e))}function In(t,e){const{name:n,symbol:a,image:o,image_data:r,decimals:i}=e;return{slug:Ft(t),name:n,symbol:a,decimals:void 0===i?Mt:Number(i),minterAddress:t,image:o&&Le(o)||r&&(s=r,(c=s,T().utils.base64toString(c)).includes("<svg")?`data:image/svg+xml;base64,${s}`:`data:image/png;base64,${s}`)||void 0};var s,c}vn([{slug:"toncoin",name:"Toncoin",symbol:"TON",decimals:9}]);var An=n(48764).lW;const{Address:Sn,fromNano:Tn}=T().utils,kn="10966001",En=60,Rn=50,Bn=100,On=4e4,Pn=5e3,Cn={mainnet:{},testnet:{}};async function _n(t,e,n,a,o,r,i){const{network:s}=m(t),c={},u=await ln(s,n);if(!u)return c.error=Oe.z.DomainNotResolved,c;if(n=u,!Sn.isValid(n))return c.error=Oe.z.InvalidToAddress,c;const d=await(l=n,N[l]);var l;if(c.addressName=null==d?void 0:d.name,c.isScam=null==d?void 0:d.isScam,BigInt(a)<BigInt(0))return c.error=Oe.z.InvalidAmount,c;const f=await Ae(t);if(!f)return c.error=Oe.z.Unexpected,c;if(o&&"string"==typeof o&&i&&!await te(s,n))return c.error=Oe.z.WalletNotInitialized,c;if(e===w.rH){const e=await ot(t);if(o&&null!=e&&e.ledger&&("string"!=typeof o||i||!(0,Ce.r)(o)))return c.error=Oe.z.UnsupportedHardwarePayload,c}else{if(o&&"string"!=typeof o)return c.error=Oe.z.Unexpected,c;const r=await it(t),i=a;let u;({tokenWallet:u,amount:a,toAddress:n,payload:o}=await yn(s,e,r,n,a,o));const d=await async function(t){return(await t.getData()).balance.toString()}(u);if(BigInt(d)<BigInt(i))return c.error=Oe.z.InsufficientBalance,c}const p=await fe(s,f);c.fee=await zn(p,(async()=>(await xn(s,f,n,a,o,r)).query));const y=await he(s,f);return BigInt(y)<BigInt(a)+BigInt(c.fee)?(c.error=Oe.z.InsufficientBalance,c):c}async function Dn(t,e,n,a,o,r,i,s){const{network:c}=m(t);try{const[u,d,l]=await Promise.all([Ae(t),it(t),vt(t,e)]),{publicKey:f,secretKey:m}=l;let p,y=await ln(c,a);if(r&&"string"==typeof r&&s){const t=await te(c,a);r=await je(r,f,t,m,d),p=An.from(r.slice(4)).toString("base64")}if(n!==w.rH){if(r&&"string"!=typeof r)throw new Error("Unknown error");({amount:o,toAddress:y,payload:r}=await yn(c,n,d,y,o,r))}y=ce(y),await Zn(c,d);const[{isInitialized:g,balance:h},v]=await Promise.all([ye(c,u),ye(c,y)]);a=v.isInitialized?y:ce(y,!1);const{seqno:b,query:I}=await xn(c,u,a,o,r,i,m),A=await zn(g,I);return BigInt(h)<BigInt(o)+BigInt(A)?{error:Oe.D.InsufficientBalance}:(await I.send(),Ln(c,d,b),{resolvedAddress:y,amount:o,seqno:b,encryptedComment:p})}catch(t){return(0,u.J)("submitTransfer",t),{error:Nn(t)}}}function Nn(t){const e="string"==typeof t?t:null==t?void 0:t.message;return null!=e&&e.includes("exitcode=35,")?Oe.D.IncorrectDeviceTime:Oe.D.UnsuccesfulTransfer}async function xn(t,e,n,a,o,r,i){const{seqno:s}=await ye(t,e);return{seqno:s,query:e.methods.transfer({secretKey:i,toAddress:n,amount:a,payload:o,seqno:s||0,sendMode:3,stateInit:r})}}async function Un(t){const{network:e}=m(t);return async function(t,e){const n=ie(t),a=await n.provider.getTransactions(e,1,void 0,void 0,void 0,!0);if(null!=a&&a.length)return Jt(a[0].transaction_id)}(e,await it(t))}async function Mn(t,e,n,a){const{network:o}=m(t),r=await it(t);let i=await ee(o,r,null!=a?a:Rn,e,n);return i=await Promise.all(i.map((t=>async function(t,e){var n;const a=null===(n=e.extraData)||void 0===n?void 0:n.body;if(!a)return e;try{const n=Ge(a);if(n.remainingBits>32){const a=await Qe(t,e.toAddress,n);"encrypted-comment"===(null==a?void 0:a.type)&&(e={...e,encryptedComment:a.encryptedComment})}}catch(t){(0,u.J)("parseTransactionBody",t)}return e}(o,t)))),i.map(Kn).map($).map(qn)}async function Wn(t,e,n){let{toncoin:a,...o}=e;const r=await Mn(t,a,void 0,n);if(!r.length)return[];a=r[r.length-1].txId;const i=Ht(a).lt,s=await Promise.all(Object.entries(o).map((e=>{let[n,o]=e;return o&&Ht(o).lt<i?[]:jn(t,n,o,a,Bn)}))),c=[...r,...s.flat()];return c.sort(((t,e)=>(0,Pe.U)(t,e,!1))),c}async function jn(t,e,n,a,o){if(e===w.rH)return Mn(t,n,a,o);const{network:r}=m(t),i=await it(t),s=gn(e).minterAddress,c=await Xt(r,i,s);return(await ee(r,c,null!=o?o:Rn,n,a)).map((t=>function(t,e,n){const{extraData:a}=t;if(null==a||!a.body)return;const o=function(t){if(t)try{let e=Re.Cell.fromBase64(t).beginParse();const n=e.loadUint(32),a=e.loadUint(64);if(n===qt.Transfer||n===qt.InternalTransfer){const t=e.loadCoins(),o=e.loadMaybeAddress(),r=e.loadMaybeAddress();let i,s;return r&&(n===qt.Transfer&&e.loadBit(),i=e.loadCoins(),e.remainingBits&&e.loadBit()&&e.remainingRefs&&(e=e.loadRef().beginParse()),e.remainingBits>32&&0===e.loadUint(32)&&(s=e.loadStringTail())),{operation:qt[n],queryId:a,jettonAmount:t,responseAddress:r,address:o?Fe(o):void 0,forwardAmount:i,forwardComment:s}}}catch(t){(0,u.J)("parseJettonWalletMsgBody",t)}}(a.body);if(!o)return;const{operation:r,jettonAmount:i,address:s,forwardComment:c}=o,d="InternalTransfer"===r;return{...t,slug:e,fromAddress:d?null!=s?s:t.fromAddress:n,toAddress:d?n:s,amount:d?i.toString():`-${i}`,comment:c,isIncoming:d}}(t,e,i))).filter(Boolean).map($).map(qn).filter(Boolean)}function qn(t){return(0,A.CE)(t,["extraData"])}function Kn(t){const{fromAddress:e,toAddress:n,comment:a,amount:o}=t;if(e&&n){const r=Math.abs(Number(Tn(o)));C(e)&&r>1?t.type="unstake":C(n)&&(a===Nt?t.type="stake":a===xt&&(t.type="unstakeRequest"))}return t}async function Jn(t,e){const{network:n}=m(t),a={};let o=0n;for(const{toAddress:t,amount:n}of e){if(BigInt(n)<BigInt(0))return a.error=Oe.z.InvalidAmount,a;if(!Sn.isValid(t))return a.error=Oe.z.InvalidToAddress,a;o+=BigInt(n)}const r=await Ae(t);if(!r)return a.error=Oe.z.Unexpected,a;const{isInitialized:i,balance:s}=await ye(n,r);return a.fee=await zn(i,(async()=>(await Fn(n,r,e)).query)),a.totalAmount=o.toString(),BigInt(s)<o+BigInt(a.fee)?(a.error=Oe.z.InsufficientBalance,a):a}async function Hn(t,e,n,a){const{network:o}=m(t);try{const[r,i,s]=await Promise.all([Ae(t),it(t),ht(t,e)]);let c=0n;const u=await Promise.all(n.map((async t=>{let{toAddress:e}=t;const n=ce(e);return e=await fe(o,e)?n:ce(e,!1),c+=BigInt(t.amount),{...t,toAddress:e,resolvedAddress:n}})));await Zn(o,i);const{isInitialized:d,balance:l}=await ye(o,r),{seqno:f,query:w}=await Fn(o,r,u,s,a),m=await zn(d,w);return BigInt(l)<BigInt(c)+BigInt(m)?{error:Oe.D.InsufficientBalance}:(await w.send(),Ln(o,i,f),{seqno:f,amount:c.toString(),messages:u})}catch(t){return(0,u.J)("submitMultiTransfer",t),{error:Nn(t)}}}async function Fn(t,e,n,a,o){const{seqno:r}=await ye(t,e);return o||(o=Math.round(Date.now()/1e3)+En),{query:e.methods.transfers({secretKey:a,seqno:r||0,messages:n,sendMode:3,expireAt:o}),seqno:r}}function Ln(t,e,n){Cn[t][e]={timestamp:Date.now(),seqno:n}}async function Zn(t,e){const n=Cn[t][e];if(!n)return;const{seqno:a,timestamp:o}=n,r=o+On,i=await async function(t,e,n,a){for(a||(a=Date.now()+On);Date.now()<a;)try{const{seqno:a}=await ye(t,e);if(a>n)return!0;await(0,_e.wO)(Pn)}catch(t){(0,u.J)("waitIncrementSeqno",t)}return!1}(t,e,a,r);i&&delete Cn[t][e]}async function zn(t,e){if("function"==typeof e&&(e=await e()),t){const t=(await e.estimateFee()).source_fees;return String(t.in_fwd_fee+t.storage_fee+t.gas_fee+t.fwd_fee)}return kn}async function $n(t,e){const{network:n}=m(t),[a,o,r]=await Promise.all([it(t),rt(t),ot(t)]),i=on(o,r.version),s=rn(n).open(i),{base64:c,seqno:u}=e;await s.send(Re.Cell.fromBase64(c)),Ln(n,a,u)}async function Vn(t,e){const{network:n}=m(t),[a,o,r]=await Promise.all([it(t),rt(t),ot(t)]),i=on(o,r.version),s=rn(n).open(i),c=Ut+e.length;let d=0,l=0;for(;d<e.length&&l<c;){const{base64:t,seqno:o}=e[d];try{await Zn(n,a),await s.send(Re.Cell.fromBase64(t)),Ln(n,a,o),d++}catch(t){(0,u.J)("sendSignedMessages",t)}l++}return{successNumber:d}}async function Qn(t,e,n,a){const o=await vt(t,a);if(!o)return;const{secretKey:r,publicKey:i}=o;return qe(An.from(e,"base64"),i,r,n)}var Gn=n(16580);const{fromNano:Xn}=T().utils;class Yn extends T().Contract{constructor(t,e){if(e.wc=0,super(t,e),!e.address)throw new Error("required address");this.methods.getListNominators=this.getListNominators.bind(this),this.methods.getPoolData=this.getPoolData.bind(this),this.methods.getMaxPunishment=this.getMaxPunishment.bind(this)}async getListNominators(){const t=await this.getAddress();return(await this.provider.call2(t.toString(),"list_nominators")).map((t=>({address:de(t[0]),amount:Xn(t[1]),pendingDepositAmount:Xn(t[2]),withdrawRequested:t[3].toNumber()})))}async getPoolData(){const t=await this.getAddress(),e=await this.provider.call2(t.toString(),"get_pool_data");return{state:e[0].toString(),nominatorsCount:e[1].toNumber(),stakeAmountSent:Xn(e[2]),validatorAmount:Xn(e[3]),validatorAddress:de(e[4]),validatorRewardShare:Math.round(e[5].toNumber()/100),maxNominatorsCount:e[6].toNumber(),minValidatorStake:Xn(e[7]),minNominatorStake:Xn(e[8]),nominators:e[9].toString(),withdrawRequests:e[10].toString(),stakeAt:e[11].toNumber(),validatorSetChangesCount:e[13].toNumber(),validatorSetChangeTime:e[14].toNumber(),stakeHeldFor:e[15].toString(),configProposalVotings:e[16].toString()}}async getMaxPunishment(t){const e=await this.getAddress();return this.provider.call2(e.toString(),"get_max_punishment",[["num",t.toString()]])}}const{toNano:ta}=T().utils,ea="1000000000",na=10001,aa=30,oa=(0,Gn.Z)((async function(t){const e=await D(`/staking-state?account=${t}`);if(!C(e.poolAddress))throw Error("Unexpected pool address, likely a malicious activity");return e}),60);async function ra(t,e){const n=await it(t),{poolAddress:a}=await oa(n),o={};return!await da(t)&&new(Pt())(e).lt(ta(na.toString()))?(o.error=Oe.z.InvalidAmount,o):_n(t,w.rH,a,e,Nt)}async function ia(t){const e=await it(t),{poolAddress:n}=await oa(e);return _n(t,w.rH,n,ea,xt)}async function sa(t,e,n){const a=await it(t),{poolAddress:o}=await oa(a),r=await Dn(t,e,w.rH,o,n,Nt);return ua(),r}async function ca(t,e){const n=await it(t),{poolAddress:a}=await oa(n),o=await Dn(t,e,w.rH,a,ea,xt);return ua(),o}function ua(){oa.disableCache(aa)}async function da(t){const{network:e}=m(t),n=await it(t),a=await async function(t,e){const{poolAddress:n}=await oa(e);return new Yn(ie(t).provider,{address:n})}(e,n);if("mainnet"!==e||!a)return{amount:0,pendingDepositAmount:0,isUnstakeRequested:!1};const o=(await a.getListNominators()).find((t=>t.address===n));return o?{amount:parseFloat(o.amount),pendingDepositAmount:parseFloat(o.pendingDepositAmount),isUnstakeRequested:o.withdrawRequested}:{amount:0,pendingDepositAmount:0,isUnstakeRequested:!1}}async function la(t){const{network:e}=m(t);if("mainnet"!==e)return;const n=await it(t);return oa(n)}const{Cell:fa}=T().boc;async function wa(t){let e=new fa;return t&&(t instanceof fa?e=t:"string"==typeof t?t.length>0&&(e.bits.writeUint(0,32),e.bits.writeString(t)):e.bits.writeBytes(t)),R(await e.toBoc())}const ma={ton:a};var pa=n(69995);class ya extends Error{constructor(t,e){super(t),this.displayError=e,Error.captureStackTrace(this),this.name=this.constructor.name}}class ga extends ya{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Canceled by the user")}}function ha(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,"string");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const va=new Map;class ba{constructor(){ha(this,"resolve",void 0),ha(this,"reject",void 0),ha(this,"promise",new Promise(((t,e)=>{this.resolve=t,this.reject=e})))}}function Ia(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,pa.Z)();const e=new ba;va.set(t,e);const{promise:n}=e;return{promiseId:t,promise:n}}function Aa(t,e){const n=va.get(t);n&&(n.resolve(e),va.delete(t))}function Sa(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Unknown rejection reason";const n=va.get(t);n&&(n.reject(new ga(e)),va.delete(t))}const{chrome:Ta}=self;let ka,Ea;const Ra={top:120,left:20,width:368,height:750};async function Ba(){if("number"==typeof ka)return await c.Z.windows.update(ka,{focused:!0}),Ea;const t=Number(await h.Z.getItem("windowId"));if(t){let e;try{await c.Z.windows.get(t),e=!0}catch(t){e=!1}if(e)return ka=t,await c.Z.windows.update(t,{focused:!0}),Ea=Promise.resolve(),Ea;await h.Z.removeItem("windowId")}return await Oa(),Ea}async function Oa(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const e=t?void 0:await h.Z.getItem("windowState");try{const t=await c.Z.windows.create({...Ra,...e,url:"index.html",type:"popup",focused:!0});if(!t)throw new Error("Failed to create extension window");ka=t.id,Ea=Ia("whenPopupReady").promise,h.Z.setItem("windowId",ka)}catch(e){if(t)throw e;await Oa(!0)}}let Pa;Ta&&(Ta.system&&Ta.system.display.getInfo((t=>{let[e]=t;e&&(Ra.left=e.bounds.width-Ra.width-20)})),c.Z.action.onClicked.addListener(Ba),c.Z.windows.onRemoved.addListener((t=>{t===ka&&("Extension popup closed",Array.from(va.keys()).forEach((t=>{Sa(t,"Extension popup closed")})),ka=void 0,Ea=void 0)})),setInterval((async()=>{const t=await c.Z.windows.getCurrent();t&&t.id===ka&&h.Z.setItem("windowState",{top:t.top,left:t.left,height:t.height,width:t.width})}),3e3));const Ca=50,_a=[];function Da(t){Pa=t,Aa("whenPopupReady")}async function Na(t,e){_a.push(t);const n=await h.Z.getItem("isTonMagicEnabled"),a=await h.Z.getItem("isDeeplinkHookEnabled");function o(){t({type:"updateTonMagic",isEnabled:Boolean(n)}),t({type:"updateDeeplinkHook",isEnabled:Boolean(a)}),e(t)}o(),setTimeout(o,Ca)}function xa(t){const e=_a.findIndex((e=>e===t));-1!==e&&_a.splice(e,1)}function Ua(t){_a.forEach((e=>{e(t)}))}async function Ma(t){await ja();const{to:e,amount:n,comment:a}=t;await Ba(),await lt(),Pa({type:"prepareTransaction",toAddress:e,amount:n,comment:a})}async function Wa(){await async function(){await c.Z.webRequest.handlerBehaviorChanged()}()}async function ja(){const t=await dt();if(!t)throw new Error("The user is not authorized in the wallet");return t}const qa={};let Ka,Ja=()=>{},Ha=()=>{};function Fa(t,e,n){Ka=t,e&&n&&(Ja=e,Ha=n)}function La(t){return qa[t]}function Za(t){const e=za(t);return!!e&&($a(e),!0)}function za(t){return Object.keys(qa).find((e=>t===qa[e]))}function $a(t){return!!qa[t]&&(delete qa[t],Ka({type:"updateActiveDapp",accountId:t}),!0)}function Va(){for(const[t,e]of Object.entries(qa))e&&(delete qa[t],Ka({type:"updateActiveDapp",accountId:t}))}async function Qa(t,e,n){const a=await async function(t,e){return(await st(t,"dapps"))[e]}(t,e);await Ga(t,n(a))}async function Ga(t,e){const n=await eo(t);n[e.origin]=e,await ut(t,"dapps",n)}async function Xa(t,e,n){const a=await eo(t);return e in a&&(function(t,e){return qa[t]===e}(t,e)&&$a(t),delete a[e],await ut(t,"dapps",a),Ka({type:"dappDisconnect",accountId:t,origin:e}),n||(Ua({type:"disconnectDapp",origin:e}),await Ha(t,e)),Ja(),!0)}async function Ya(t){$a(t);const e=Object.keys(await eo(t));await ut(t,"dapps",{}),await Promise.all(e.map((async e=>{Ka({type:"dappDisconnect",accountId:t,origin:e}),await Ha(t,e)}))),Ja()}async function to(t){return Object.values(await eo(t))}async function eo(t){return await st(t,"dapps")||{}}async function no(t,e){const n=await eo(t);return Object.values(n).some((t=>t.origin===e))}function ao(){return I.getItem("dapps")}async function oo(t){await ct(t,"dapps"),Ja()}async function ro(){await I.removeItem("dapps"),Ja()}const io=(null!==w.s1&&void 0!==w.s1?w.s1:"").split(" ").map((t=>{const[e,n]=t.split(":");return{type:"http",host:e,port:n}})),so=(co=io)[(0,uo=co.length-1,Math.floor(Math.random()*(uo-0+1)+0))];var co,uo;const lo=`function FindProxyForURL(url, host) {\n  return host.endsWith('.ton') || host.endsWith('.adnl') || host.endsWith('.bag')\n    ? 'PROXY ${so.host}:${so.port}'\n    : 'DIRECT';\n}`;let fo,wo,mo=!1;async function po(t){fo=t,ho(await I.getItem("isTonProxyEnabled")),Io(await I.getItem("isDeeplinkHookEnabled"))}function yo(){Io(!0),fo({type:"updateDeeplinkHookState",isEnabled:Boolean(!0)})}async function go(){ho(!1),bo(!1),Io(!1),await Promise.all([I.removeItem("isTonMagicEnabled"),I.removeItem("isTonProxyEnabled"),I.removeItem("isDeeplinkHookEnabled"),I.removeItem("dapps")])}function ho(t){w.s1&&mo!==t&&(mo=t,I.setItem("isTonProxyEnabled",t),y.w5?t?c.Z.proxy.onRequest.addListener(vo,{urls:["*://*.ton/*","*://*.adnl/*","*://*.bag/*"]}):c.Z.proxy.onRequest.removeListener(vo):t?c.Z.proxy.settings.set({scope:"regular",value:{mode:"pac_script",pacScript:{data:lo}}}):c.Z.proxy.settings.clear({scope:"regular"}))}function vo(){return io}function bo(t){I.setItem("isTonMagicEnabled",t),Ua({type:"updateTonMagic",isEnabled:t})}function Io(t){I.setItem("isDeeplinkHookEnabled",t),Ua({type:"updateDeeplinkHook",isEnabled:t})}function Ao(t){wo=t}function So(t,e){return ma[L(t)].checkStakeDraft(t,e)}function To(t){return ma[L(t)].checkUnstakeDraft(t)}async function ko(t,e,n,a){const o=ma[L(t)],r=await it(t),i=await o.submitStake(t,e,n);if("error"in i)return!1;const s=z(wo,t,{amount:i.amount,fromAddress:r,toAddress:i.resolvedAddress,comment:Nt,fee:a||"0",type:"stake",slug:w.rH});return{...i,txId:s.txId}}async function Eo(t,e,n){const a=ma[L(t)],o=await it(t),r=await a.submitUnstake(t,e);if("error"in r)return!1;const i=z(wo,t,{amount:r.amount,fromAddress:r.resolvedAddress,toAddress:o,comment:xt,fee:n||"0",type:"unstakeRequest",slug:w.rH});return{...r,txId:i.txId}}function Ro(t){return ma[L(t)].getStakingState(t)}async function Bo(t){const e=await ma.ton.getBackendStakingState(t);if(!e)return e;const n=e.poolState;return{...e,poolState:{...n,startOfCycle:1e3*n.startOfCycle,endOfCycle:1e3*n.endOfCycle}}}const Oo=1100,Po=3e4,Co=6e4,_o=2e3,Do=20,No=Math.round(3e4/Oo);let xo,Uo,Mo,Wo,jo;const qo={};function Ko(t,e,n){xo=t,Uo=e,Mo=n.origin,Wo=Promise.all([U(),zo(t)]),Lo(),Zo()}function Jo(t){const e=hn();let n=!1;for(const{token:a}of t.filter(Boolean))a.slug in e||(n=!0,e[a.slug]={...a,quote:jo[a.slug]||{price:0,percentChange1h:0,percentChange24h:0,percentChange7d:0,percentChange30d:0}});n&&$o()}async function Ho(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=ma[L(t)];delete qo[t];let a,o=!0,r=Math.round(Date.now()/1e3),i=0;const s=xo;for(;V(s)&&Uo(t);){try{const[c,u]=await Promise.all([n.getAccountBalance(t).catch(Qo),n.getStakingState(t).catch(Qo)]);if(!V(s)||!Uo(t))return;if(u&&xo({type:"updateStakingState",accountId:t,stakingState:u}),i%No==0){r=Math.round(Date.now()/1e3);const e=await n.getAccountNfts(t);if(!V(s)||!Uo(t))return;xo({type:"updateNfts",accountId:t,nfts:e})}const d=qo[t],l=[];if(!c||c===(null==d?void 0:d.balance)){await(0,_e.wO)(Oo);continue}l.push(w.rH),xo({type:"updateBalance",accountId:t,slug:w.rH,balance:c}),qo[t]={...qo[t],balance:c};const f=await n.getAccountTokenBalances(t).catch(Qo);if(!V(s)||!Uo(t))return;if(f){Jo(f);for(const{slug:e,balance:n}of f)((null==d?void 0:d.tokenBalances)&&d.tokenBalances[e])!==n&&(l.push(e),xo({type:"updateBalance",accountId:t,slug:e,balance:n}));qo[t]={...qo[t],tokenBalances:Object.fromEntries(f.map((t=>{let{slug:e,balance:n}=t;return[e,n]})))}}if(l.length){o||await(0,_e.wO)(_o);const n=await Fo(t,e,l);e={...e,...n}}if([r,a]=await n.getNftUpdates(t,r),!V(s)||!Uo(t))return;a.forEach(xo),o=!1,i++}catch(t){(0,u.J)("setupBalancePolling",t)}await(0,_e.wO)(Oo)}}async function Fo(t,e,n){const a=ma[L(t)];if(!n.length)return{};let o=[];const r=await Promise.all(n.map((async n=>{let r=e[n];const i=await a.getTokenTransactionSlice(t,n,void 0,r);return i.length&&(r=i[0].txId,o=o.concat(i.slice(0,Do))),[n,r]})));return o.sort(((t,e)=>(0,Pe.U)(t,e,!0))),o.forEach((t=>{j.runCallbacks(t)})),xo({type:"newTransactions",transactions:o,accountId:t}),Object.fromEntries(r)}async function Lo(){const t=xo;for(;V(t);){if(await(0,_e.wO)(Po),!V(t))return;try{await zo(t)}catch(t){(0,u.J)("setupBackendPolling",t)}}}async function Zo(){for(;V(xo);){await(0,_e.wO)(Co);try{await U()}catch(t){(0,u.J)("setupLongBackendPolling",t)}}}async function zo(t){try{const[e,n]=await Promise.all([D("/prices",void 0,{"X-App-Origin":Mo,"X-App-Version":w.Ji}),D("/known-tokens")]);if(!V(t))return;vn(n),jo=Object.values(e).reduce(((t,e)=>{let{slugs:n,quote:a}=e;for(const e of n)t[e]=a;return t}),{}),$o()}catch(t){(0,u.J)("tryUpdateTokens",t)}}function $o(){const t=hn();Object.values(t).forEach((t=>{t.slug in jo&&(t.quote=jo[t.slug])})),xo({type:"updateTokens",tokens:t})}async function Vo(t){for(;V(xo)&&Uo(t);){try{const e=await Bo(t);if(!V(xo)||!Uo(t))return;e&&xo({type:"updateBackendStakingState",backendStakingState:e})}catch(t){(0,u.J)("setupBackendStakingStatePolling",t)}await(0,_e.wO)(Po)}}function Qo(t){(0,u.J)("Polling error",t)}async function Go(){await Wo}let Xo,Yo;async function tr(t,e){await H;const n=Xo,a=!n;Xo=t,await I.setItem("currentAccountId",t),tt(),y.FH&&(n&&m(n).network!==m(t).network&&Va(),a&&yo(),function(t){const e=La(t);Ka({type:"updateActiveDapp",accountId:t,origin:e})}(t)),a&&$o(),Ho(t,e),Vo(t)}function er(){nr(),Xo=void 0,y.FH&&(Va(),go())}function nr(){y.FH&&$a(Xo)}function ar(t){return Xo===t}function or(t){return ot(t)}function rr(){return Xo}function ir(){return ma.ton.generateMnemonic()}async function sr(t,e,n){const{mnemonicToSeed:a,seedToKeyPair:o,publicKeyToAddress:r}=ma.ton;if(!await cr(e))throw new Error("Invalid mnemonic");const i=await a(e),{publicKey:s}=o(i),c=await r(t,s),u=await at(t);return await lr(u,e,n,s,c),tr(u),{accountId:u,address:c}}function cr(t){return ma.ton.validateMnemonic(t)}async function ur(t,e,n){const{mnemonicToSeed:a,seedToKeyPair:o,pickBestWallet:r}=ma.ton;if(!await cr(e))throw new Error("Invalid mnemonic");const i=await a(e),{publicKey:s}=o(i),c=await r(t,s),u=(await c.getAddress()).toString(!0,!0,!0),d=await at(t);return await lr(d,e,n,s,u),tr(d),{accountId:d,address:u}}async function dr(t,e){const n=await at(t),{publicKey:a,address:o,index:r,driver:i,deviceId:s,deviceName:c,version:u}=e;return await async function(t,e,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o="string"==typeof e?e:k(e);await Promise.all([ut(t,"publicKeys",o),ut(t,"addresses",n),ut(t,"accounts",a)])}(n,a,o,{version:u,ledger:{index:r,driver:i,deviceId:s,deviceName:c}}),tr(n),{accountId:n,address:o,walletInfo:e}}async function lr(t,e,n,a,o){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const i=await ma.ton.encryptMnemonic(e,n),s="string"==typeof a?a:k(a);await Promise.all([ut(t,"mnemonicsEncrypted",i),ut(t,"publicKeys",s),ut(t,"addresses",o),ut(t,"accounts",r)])}async function fr(){er(),await Promise.all([I.removeItem("addresses"),I.removeItem("publicKeys"),I.removeItem("mnemonicsEncrypted"),I.removeItem("accounts"),I.removeItem("currentAccountId"),y.qV&&ro()])}async function wr(t,e,n){await Promise.all([ct(t,"addresses"),ct(t,"publicKeys"),ct(t,"mnemonicsEncrypted"),ct(t,"accounts"),y.qV&&oo(t)]),nr(),await tr(e,n)}const mr=ma.ton;async function pr(t){Yo=t;const e=await I.getItem("isTonProxyEnabled");Yo({type:"updateTonProxyState",isEnabled:Boolean(e)});const n=await I.getItem("isTonMagicEnabled");Yo({type:"updateTonMagicState",isEnabled:Boolean(n)});const a=await I.getItem("isDeeplinkHookEnabled");Yo({type:"updateDeeplinkHookState",isEnabled:Boolean(a)})}function yr(t,e){return ma[L(t)].fetchMnemonic(t,e)}async function gr(t){const e=await async function(){const t=await nt(),e=(await Promise.all(t.map((async t=>{const e=await ot(t);return{...m(t),accountId:t,hasLedger:!(null==e||!e.ledger)}})))).filter((t=>!t.hasLedger));if(!e.length)return;const n=(0,A.ee)(e,"id"),a=Object.keys(n);return a.length?n[Math.min(...a.map(Number))].accountId:void 0}();if(!e)throw new Error("The user is not authorized in the wallet");return ma[L(e)].verifyPassword(e,t)}function hr(t,e){Aa(t,e)}function vr(t,e){Aa(t,e)}function br(t,e){Sa(t,e)}async function Ir(t){const{network:e}=m(t),n=await it(t);return mr.getWalletSeqno(e,n)}function Ar(t){return it(t)}function Sr(t){return rt(t)}function Tr(t,e){return ma.ton.isWalletInitialized(t,e)}let kr;function Er(t){kr=t}function Rr(t){return ma[L(t)].getAccountTransactionSlice(t)}function Br(t,e,n,a){return ma[L(t)].getTokenTransactionSlice(t,e,n,void 0,a)}function Or(t,e,n){return ma[L(t)].getMergedTransactionSlice(t,e,n)}function Pr(t,e,n,a,o,r){return ma[L(t)].checkTransactionDraft(t,e,n,a,o,void 0,r)}async function Cr(t){const{accountId:e,password:n,slug:a,toAddress:o,amount:r,comment:i,fee:s,shouldEncrypt:c}=t,u=ma[L(e)],d=await it(e),l=await u.submitTransfer(e,n,a,o,r,i,void 0,c);if("error"in l)return l;const{encryptedComment:f}=l,w=z(kr,e,{amount:r,fromAddress:d,toAddress:o,comment:c?void 0:i,encryptedComment:f,fee:s||"0",slug:a});return{...l,txId:w.txId}}async function _r(t){const e=ma.ton,{network:n}=m(t),a=await it(t);return e.waitLastTransfer(n,a)}async function Dr(t,e){const n=ma[L(t)];return await n.sendSignedMessage(t,e),z(kr,t,e.params).txId}async function Nr(t,e){const n=ma.ton,a=await n.sendSignedMessages(t,e);for(let n=0;n<a.successNumber;n++)z(kr,t,e[n].params);return a}function xr(t,e,n,a){return ma.ton.decryptComment(t,e,n,a)}function Ur(t){return ma[L(t)].getAccountNfts(t)}function Mr(t,e){const{network:n,blockchain:a}=m(t);return ma[a].importToken(n,e)}function Wr(t){return ma.ton.resolveTokenBySlug(t)}function jr(t,e,n){return ma.ton.resolveTokenWalletAddress(t,e,n)}function qr(t,e){return ma.ton.resolveTokenMinterAddress(t,e)}var Kr=n(1085);let Jr=function(t){return t[t.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",t[t.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",t[t.MANIFEST_NOT_FOUND_ERROR=2]="MANIFEST_NOT_FOUND_ERROR",t[t.MANIFEST_CONTENT_ERROR=3]="MANIFEST_CONTENT_ERROR",t[t.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",t[t.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",t[t.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED",t}({}),Hr=function(t){return t[t.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",t[t.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",t[t.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",t[t.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",t[t.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED",t}({}),Fr=function(t){return t[t.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",t[t.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",t[t.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",t[t.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",t[t.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED",t}({});class Lr extends ya{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;var a,o,r;super(t),a=this,r=void 0,(o=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,"string");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(o="code"))in a?Object.defineProperty(a,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[o]=r,this.code=e,this.displayError=n}}class Zr extends Lr{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Manifest content error",Jr.MANIFEST_CONTENT_ERROR)}}class zr extends Lr{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unknown error",0)}}class $r extends Lr{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Bad request",1,arguments.length>1?arguments[1]:void 0)}}function Vr(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return"string"==typeof t&&t.length<=e}function Qr(t){if(!Vr(t,150))return!1;try{return new URL(t),!0}catch(t){return!1}}var Gr=n(48764).lW;const{Address:Xr}=T().utils,Yr=ma.ton;let ti;const ei=new Promise((t=>{ti=t}));let ni;function ai(t){ni=t,ti()}async function oi(t,e,n){try{const{origin:a}=await mi(t,!0),o={...await wi(a,e.manifestUrl),connectedAt:Date.now()},r=e.items.find((t=>{let{name:e}=t;return"ton_addr"===e})),i=e.items.find((t=>{let{name:e}=t;return"ton_proof"===e})),s=i?{timestamp:Math.round(Date.now()/1e3),domain:new URL(a).host,payload:i.payload}:void 0;if(!r)throw new $r("Missing 'ton_addr'");await pi();const c=await async function(){const t=await dt();if(!t)throw new $r("The user is not authorized in the wallet");return t}();let u;if(!await no(c,a)||s){await pi(!0);const{promiseId:t,promise:e}=Ia();ni({type:"dappConnect",promiseId:t,accountId:c,dapp:o,permissions:{address:!0,proof:!!s},proof:s}),u=await e;const{additionalAccountIds:n}=u;n?await async function(t,e){const n=await I.getItem("dapps")||{};e.forEach((e=>{const a=Z(e),o=n[a]||{};o[t.origin]=t,n[a]=o})),await I.setItem("dapps",n)}(o,[c].concat(n)):await Ga(c,o)}const d=await ri(t,n);if("connect"===d.event&&s){const t=await it(c),{password:e,signature:n}=u;let a;a=e?await async function(t,e,n,a){const o=await vt(t,e),{timestamp:r,domain:i,payload:s}=a,c=Gr.allocUnsafe(8);c.writeBigInt64LE(BigInt(r));const u=Gr.from(i),d=Gr.allocUnsafe(4);d.writeInt32LE(u.byteLength);const l=new Xr(n),f=Gr.allocUnsafe(4);f.writeInt32BE(l.wc);const w=Gr.concat([f,Gr.from(l.hashPart)]),m=Gr.concat([Gr.from("ton-proof-item-v2/","utf8"),w,d,u,c,Gr.from(s)]),p=Gr.concat([Gr.from("ffff","hex"),Gr.from("ton-connect","utf8"),Gr.from(await O(m))]);return fi(a,R(X().sign.detached(Gr.from(await O(p)),o.secretKey)))}(c,e,t,s):fi(s,n),d.payload.items.push(a)}return d}catch(t){return(0,u.J)("tonConnect:connect",t),di(n,t)}}async function ri(t,e){try{const{origin:n,accountId:a}=await mi(t);!function(t,e){const n=za(e);qa[t]=e,Ka&&V(Ka)&&(n&&Ka({type:"updateActiveDapp",accountId:n}),Ka({type:"updateActiveDapp",accountId:t,origin:e}))}(a,n),await Qa(a,n,(t=>({...t,connectedAt:Date.now()})));const o=await it(a);return{event:"connect",id:e,payload:{items:[await li(a,o)]}}}catch(t){return(0,u.J)("tonConnect:reconnect",t),di(e,t)}}async function ii(t,e){try{const{origin:e,accountId:n}=await mi(t);$a(n),await Xa(n,e,!0)}catch(t){(0,u.J)("tonConnect:disconnect",t)}return{event:"disconnect",id:Number(e.id),payload:{}}}async function si(t,e){try{const{origin:n,accountId:a}=await mi(t),o=JSON.parse(e.params[0]),r=o.messages.slice(0,3);let i=o.valid_until;i&&i>10**10&&(i=Math.round(i/1e3));const{network:s}=m(a),c=await ot(a),u=!(null==c||!c.ledger);await pi(!0);const{preparedMessages:d,checkResult:l}=await async function(t,e){const n=e.map((t=>{const{address:e,amount:n,payload:a,stateInit:o}=t;return{toAddress:e,amount:n,payload:a?Yr.oneCellFromBoc(B(a)):void 0,stateInit:o?Yr.oneCellFromBoc(B(o)):void 0}})),a=await Yr.checkMultiTransactionDraft(t,n);return function(t){let{error:e}=t;if(e)throw ni({type:"showError",error:e}),new $r(e)}(a),{preparedMessages:n,checkResult:a}}(a,r),f=(await eo(a))[n],p=await function(t,e,n){return Promise.all(e.map((async e=>{let{address:a,amount:o,payload:r,stateInit:i}=e;const s=await Yr.isWalletInitialized(t,a),c=ce(a),u=s?c:ce(a,!1),d=r?await Ve(t,u,r):void 0;if(n&&d&&(!Wt.includes(d.type)||"comment"===d.type&&!(0,Ce.r)(d.comment)||"transfer-nft"===d.type&&d.forwardPayload))throw new $r("Unsupported payload",Oe.D.UnsupportedHardwarePayload);return{resolvedAddress:c,toAddress:u,amount:o,rawPayload:r,payload:d,stateInit:i}})))}(s,r,u),{promiseId:y,promise:g}=Ia();ni({type:"dappSendTransactions",promiseId:y,accountId:a,dapp:f,transactions:p,fee:l.fee});const h=await g;if(i&&i<Date.now()/1e3)throw new $r("The confirmation timeout has expired");let v,b;if(u)v=await Yr.sendSignedMessages(a,h),b=v.successNumber,b>0?b<r.length&&ni({type:"showError",error:Oe.D.PartialTransactionFailure}):v={error:"Failed transfers"};else{const t=h;b=r.length,v=await Yr.submitMultiTransfer(a,t,d,i)}if("error"in v)throw new zr(v.error);const I=await it(a);return p.slice(0,b).forEach((t=>{let{amount:e,resolvedAddress:n,payload:o}=t;const r="comment"===(null==o?void 0:o.type)?o.comment:void 0;z(ni,a,{amount:e,fromAddress:I,toAddress:n,comment:r,fee:l.fee,slug:w.rH})})),{result:"ok",id:e.id}}catch(t){(0,u.J)("tonConnect:sendTransaction",t);let n,a=Hr.UNKNOWN_ERROR,o="Unhandled error";return t instanceof ga?(a=Hr.USER_REJECTS_ERROR,o=t.message):t instanceof Lr?(a=t.code,o=t.message,n=t.displayError):n=Oe.D.Unexpected,ni&&V(ni)&&n&&ni({type:"showError",error:n}),{error:{code:a,message:o},id:e.id}}}function ci(t,e){return{error:{code:Fr.METHOD_NOT_SUPPORTED,message:"Method not supported"},id:e.id}}async function ui(t){try{const{origin:e}=await mi(t,!0);Za(e)}catch(t){(0,u.J)("tonConnect:deactivate",t)}}function di(t,e){let n=Jr.UNKNOWN_ERROR,a="Unhandled error";return e instanceof ga?(n=Jr.USER_REJECTS_ERROR,a=e.message):e instanceof Lr&&(n=e.code,a=e.message),{id:t,event:"connect_error",payload:{code:n,message:a}}}async function li(t,e){const{network:n}=m(t),[a,o]=await Promise.all([Yr.getWalletStateInit(t),rt(t)]);return{name:"ton_addr",address:ue(e),network:"mainnet"===n?Kr.sX.MAINNET:Kr.sX.TESTNET,publicKey:o,walletStateInit:a}}function fi(t,e){const{timestamp:n,domain:a,payload:o}=t,r=Gr.from(a);return{name:"ton_proof",proof:{timestamp:n,domain:{lengthBytes:r.byteLength,value:r.toString("utf8")},signature:e,payload:o}}}async function wi(t,e){try{const n=await fetch(e);P(n);const{url:a,name:o,iconUrl:r}=await n.json();if(!Qr(a)||!Vr(o)||!Qr(r))throw new Error("Invalid data");return{origin:t,url:a,name:o,iconUrl:r,manifestUrl:e}}catch(t){throw(0,u.J)("fetchDapp",t),new Zr}}async function mi(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{origin:n}=t;if(!n)throw new $r("Invalid origin");let a="";if(t.accountId)a=t.accountId;else if(!e){const{network:t}=m(await ja()),e=await async function(t,e){const n=await ao()||{};let a,o=0;if(Object.entries(n).forEach((t=>{let[n,r]=t;e in r&&r[e].connectedAt>o&&(o=r[e].connectedAt,a=n)})),a)return p({...m(a),network:t})}(t,n);if(!e)throw new $r("The connection is outdated, try relogin");a=e}return{origin:n,accountId:a}}async function pi(t){!y.FH||!t&&ni&&V(ni)||(await Ba(),await ei)}var yi=n(48764).lW;const gi="https://tonconnectbridge.mytonwallet.org/bridge",hi=300,vi=24;let bi,Ii=[];async function Ai(t,e){await lt();const n=new URL(t).searchParams,a=Number(n.get("v")),o=n.get("id"),r=JSON.parse(n.get("r")),i=n.get("ret"),s=new URL(r.manifestUrl).origin;(0,u.o)("SSE Start connection:",{version:a,appClientId:o,request:r,ret:i,origin:s});const c=rr(),d=await oi({origin:s},r,0);"connect"===d.event&&(d.payload.device=e);const{secretKey:l,publicKey:f}=X().box.keyPair(),w=k(l),m=k(f);await ki(d,w,m,o),"connect_error"!==d.event&&(await Qa(c,s,(t=>({...t,sse:{clientId:m,appClientId:o,secretKey:w,lastOutputId:0}}))),Si())}async function Si(){bi&&(bi.close(),bi=void 0);const[t,e]=await Promise.all([I.getItem("sseLastEventId"),ao()]);if(!e)return;Ii=Object.entries(e).reduce(((t,e)=>{let[n,a]=e;const o=p(m(n));for(const e of Object.values(a))t.push({...e.sse,accountId:o,origin:e.origin});return t}),[]);const n=(0,A.Dr)(Ii,"clientId");n.length&&(bi=function(t,e){const n=new URL(`${gi}/events`);return n.searchParams.set("client_id",t.join(",")),e&&n.searchParams.set("last_event_id",e),new EventSource(n)}(n,t),bi.onmessage=async t=>{const{from:e,message:n}=JSON.parse(t.data),a=Ii.find((t=>{let{appClientId:n}=t;return n===e}));if(!a)return;const{accountId:o,clientId:i,appClientId:s,secretKey:c,origin:d}=a,l=function(t,e,n){const a=yi.from(t,"base64"),o=a.subarray(0,vi),r=a.subarray(vi),i=X().box.open(r,o,yi.from(e,"hex"),yi.from(n,"hex")),s=new TextDecoder("utf-8").decode(i);return JSON.parse(s)}(n,s,c);(0,u.o)("SSE Event:",l),await function(t){return I.setItem("sseLastEventId",t)}(t.lastEventId);const f=await r[l.method]({origin:d,accountId:o},l);await ki(f,c,i,s)})}async function Ti(t,e){const n=Ii.find((n=>n.origin===e&&n.accountId===t));if(!n)return;const{secretKey:a,clientId:o,appClientId:r}=n,i=n.lastOutputId+1;await ki({event:"disconnect",id:i,payload:{}},a,o,r)}function ki(t,e,n,a,o){const r=function(t,e,n){const a=(0,G.randomBytes)(vi),o=X().box(t,a,yi.from(e,"hex"),yi.from(n,"hex"));return yi.concat([a,o]).toString("base64")}(yi.from(JSON.stringify(t)),a,e);return async function(t,e,n,a){const o=new URL(`${gi}/message`);o.searchParams.set("client_id",e),o.searchParams.set("to",n),o.searchParams.set("ttl",hi.toString()),a&&o.searchParams.set("topic",a),P(await fetch(o,{method:"POST",body:t}))}(r,n,a,o)}function Ei(t){return _("/swap/ton/estimate",t)}function Ri(t){return _("/swap/ton/build",t)}function Bi(){return D("/swap/currencies")}function Oi(){return D("/swap/ton/tokens")}function Pi(){return D("/swap/ton/pairs")}const Ci=ma.ton;let _i;function Di(t){_i=t}async function Ni(t){t({type:"updateAccounts",accounts:await Ui()})}async function xi(){const t=await ja();return Ci.getAccountBalance(t)}async function Ui(){const t=await dt();return t?[await it(t)]:[]}async function Mi(){const t=await dt();if(!t)return[];const[e,n,a]=await Promise.all([it(t),rt(t),Ci.pickAccountWallet(t)]);return[{address:e,publicKey:n,walletVersion:a?Ci.resolveWalletVersion(a):void 0}]}async function Wi(t){const e=await ja(),{value:n,to:a,data:o,dataType:r,stateInit:i}=t;let s;if(o)switch(r){case"hex":s=E(o);break;case"base64":s=B(o);break;case"boc":s=Ci.oneCellFromBoc(B(o));break;default:s=o}const c=i?Ci.oneCellFromBoc(B(i)):void 0;await Ba(),await lt();const d=await Ci.checkTransactionDraft(e,w.rH,a,n,s,c);if(!d||null!=d&&d.error)return _i({type:"showError",error:null==d?void 0:d.error}),!1;const{promiseId:l,promise:f}=Ia(),p=await ot(e);if(null!=p&&p.ledger)return async function(t,e,n,a,o){const{network:r}=m(t),i=await it(t),{to:s,value:c,data:d,dataType:l,stateInit:f}=o;let p;if(d)switch(l){case"hex":p=await Ci.packPayloadToBoc(E(d));break;case"base64":p=await Ci.packPayloadToBoc(B(d));break;case"boc":p=d;break;case"text":p=await Ci.packPayloadToBoc(d);break;default:p=void 0}const y=p?await Ci.parsePayloadBase64(r,s,p):void 0;_i({type:"createTransaction",promiseId:e,toAddress:s,amount:c,fee:a,..."text"===l&&{comment:d},stateInit:f,rawPayload:p,parsedPayload:y});try{const[e]=await n;await Ci.sendSignedMessage(t,e)}catch(t){return(0,u.J)("sendLedgerTransaction",t),!1}return z(_i,t,{amount:c,fromAddress:i,toAddress:s,fee:a,slug:w.rH,..."text"===l&&{comment:d}}),!0}(e,l,f,d.fee,t);_i({type:"createTransaction",promiseId:l,toAddress:a,amount:n,fee:d.fee,..."text"===r&&{comment:o}});const y=await f;if("error"in await Ci.submitTransfer(e,y,w.rH,a,n,s,c))return!1;const g=await it(e);return z(_i,e,{amount:n,fromAddress:g,toAddress:a,fee:d.fee,slug:w.rH,..."text"===r&&{comment:o}}),!0}async function ji(t){let{data:e}=t;const n=await ja();await Ba(),await lt();const{promiseId:a,promise:o}=Ia();_i({type:"createSignature",promiseId:a,dataHex:e});const r=await o;return Ci.rawSign(n,r,e)}async function qi(t,e){const n=e=>t(e);(function(t){F=t})(n),Ko(n,ar,e),Er(n),pr(n),Ao(n),y.qV&&(Fa(n,w.s4?Si:void 0,w.s4?Ti:void 0),ai(n)),y.FH&&(po(n),Di(n),Da(n)),await(H=async function(){let t=Number(await I.getItem("stateVersion"));if(t!==J){if(!t&&!await I.getItem("addresses")){if(t=await v.Z.getItem("stateVersion"),!y.FH||!t)return void await I.setItem("stateVersion",J);{const t=await v.Z.getAll();await I.setMany(t)}}if(!t){const e=await I.getItem("mnemonicEncrypted");if(e&&(await I.setItem("mnemonicsEncrypted",JSON.stringify({[w.fi]:e})),await I.removeItem("mnemonicEncrypted")),!e)for(const t of["mnemonicsEncrypted","addresses","publicKeys"]){const e=await I.getItem(t);if(!e)continue;const n=JSON.parse(e),a=Object.entries(n).reduce(((t,e)=>{let[n,a]=e;return t[Z(n)]=a,t}),{});await I.setItem(t,JSON.stringify(a))}t=1,await I.setItem("stateVersion",t)}if(1===t){const e=await I.getItem("addresses");if(e&&e.includes("-undefined"))for(const t of["mnemonicsEncrypted","addresses","publicKeys"]){const e=(await I.getItem(t)).replace("-undefined","-ton");await I.setItem(t,e)}t=2,await I.setItem("stateVersion",t)}if(t>=2&&t<=4){for(const t of["addresses","mnemonicsEncrypted","publicKeys","dapps"]){const e=await I.getItem(t);"string"==typeof e&&await I.setItem(t,JSON.parse(e))}t=5,await I.setItem("stateVersion",t)}if(5===t){const e=await I.getItem("dapps");if(e){for(const t of Object.values(e))for(const e of Object.values(t))e.connectedAt=1;await I.setItem("dapps",e)}t=6,await I.setItem("stateVersion",t)}}}(),H),w.s4&&Si()}l("MyTonWallet_popup",(function(t,e){for(var n=arguments.length,a=new Array(n>2?n-2:0),o=2;o<n;o++)a[o-2]=arguments[o];return"init"===t?qi(a[0],a[1]):(0,i[t])(...a)}),void 0,(function(){F=void 0}));const Ki=new Set(["ton_getBalance","ton_requestAccounts","ton_requestWallets","ton_sendTransaction","ton_rawSign","flushMemoryCache","prepareTransaction","tonConnect_connect","tonConnect_reconnect","tonConnect_disconnect","tonConnect_sendTransaction","tonConnect_deactivate"]);l("MyTonWallet_contentScript",(function(t,e){for(var n=arguments.length,a=new Array(n>2?n-2:0),i=2;i<n;i++)a[i-2]=arguments[i];if("init"===t)return Na(a[0],Ni);if(!Ki.has(t))throw new Error("Method not allowed");if(t.startsWith("ton_"))return t=t.replace("ton_",""),(0,s[t])(...a);if(t.startsWith("tonConnect_")){const n={origin:e};return t=t.replace("tonConnect_",""),(0,r[t])(...[n].concat(a))}return(0,o[t])(...a)}),"MyTonWallet_pageConnector",(t=>{xa(t)}),!0)},60782:(t,e,n)=>{"use strict";function a(t,e){return t.reduce(((t,n)=>(t[n[e]]=n,t)),{})}function o(t,e){return Object.keys(t).reduce(((n,a,o)=>(n[a]=e(t[a],a,o,t),n)),{})}function r(t,e){return e.reduce(((e,n)=>(e[n]=t[n],e)),{})}function i(t,e){const n=new Set(e.map(String));return r(t,Object.keys(t).filter((t=>!n.has(t))))}function s(t){return t.filter(Boolean)}function c(t,e){return t.length===e.length&&t.every(((t,n)=>t===e[n]))}function u(t,e){const n=[];for(let a=t;a<e;)n.push(a++);return n}function d(t,e){return t.reduce(((t,n,a)=>(t[n]=Array.isArray(e)?e[a]:e,t)),{})}function l(t,e){return t.map((t=>t[e]))}n.d(e,{AN:()=>d,CE:()=>i,Dr:()=>l,Q8:()=>o,ee:()=>a,ei:()=>r,et:()=>c,oA:()=>s,w6:()=>u})},41535:(t,e,n)=>{"use strict";n.d(e,{J:()=>o,o:()=>r});var a=n(83716);function o(t){if(a.eM){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];console.error(`[DEBUG][${t}]`,...n)}}function r(t){if(a.eM){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];console.log("[DEBUG]",t,...n)}}},69118:(t,e,n)=>{"use strict";n.d(e,{wO:()=>a});const a=t=>new Promise((e=>{setTimeout((()=>e()),t)}))},88924:()=>{}},n={};function a(t){var o=n[t];if(void 0!==o)return o.exports;var r=n[t]={id:t,loaded:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.loaded=!0,r.exports}a.m=e,t=[],a.O=(e,n,o,r)=>{if(!n){var i=1/0;for(d=0;d<t.length;d++){for(var[n,o,r]=t[d],s=!0,c=0;c<n.length;c++)(!1&r||i>=r)&&Object.keys(a.O).every((t=>a.O[t](n[c])))?n.splice(c--,1):(s=!1,r<i&&(i=r));if(s){t.splice(d--,1);var u=o();void 0!==u&&(e=u)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[n,o,r]},a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t={204:0};a.O.j=e=>0===t[e];var e=(e,n)=>{var o,r,[i,s,c]=n,u=0;if(i.some((e=>0!==t[e]))){for(o in s)a.o(s,o)&&(a.m[o]=s[o]);if(c)var d=c(a)}for(e&&e(n);u<i.length;u++)r=i[u],a.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return a.O(d)},n=self.webpackChunkmytonwallet=self.webpackChunkmytonwallet||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})();var o=a.O(void 0,[780,391,466,412,220],(()=>a(30514)));o=a.O(o)})();
//# sourceMappingURL=extensionServiceWorker.js.map